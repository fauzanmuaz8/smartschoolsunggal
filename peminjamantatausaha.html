<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Inventaris Aset TU</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
</head>
<body class="bg-light">

  <div class="container py-4">
    <h2 class="text-center mb-4">📦 Inventaris Aset Tata Usaha</h2>

    <!-- Form Peminjaman -->
    <div class="card mb-4">
      <div class="card-header bg-primary text-white">Form Peminjaman Aset</div>
      <div class="card-body">
        <form id="formPinjam">
          <div class="row g-3">
            <div class="col-md-6"><input class="form-control" id="namaAsetPinjam" placeholder="Nama Aset" required></div>
            <div class="col-md-6"><input class="form-control" id="kodeAsetPinjam" placeholder="Kode Aset" required></div>
            <div class="col-md-4"><input type="date" class="form-control" id="tanggalPinjam" required></div>
            <div class="col-md-4"><input class="form-control" id="namaPeminjam" placeholder="Nama Peminjam" required></div>
            <div class="col-md-4"><input class="form-control" id="lokasiPinjam" placeholder="Lokasi Digunakan" required></div>
          </div>
          <button class="btn btn-success mt-3">Simpan Peminjaman</button>
        </form>
      </div>
    </div>

    <!-- Form Pengembalian -->
    <div class="card mb-4">
      <div class="card-header bg-success text-white">Form Pengembalian Aset</div>
      <div class="card-body">
        <form id="formKembali">
          <div class="row g-3">
            <div class="col-md-6"><input class="form-control" id="namaAsetKembali" placeholder="Nama Aset" required></div>
            <div class="col-md-6"><input class="form-control" id="kodeAsetKembali" placeholder="Kode Aset" required></div>
            <div class="col-md-4"><input type="date" class="form-control" id="tanggalKembali" required></div>
            <div class="col-md-4"><input class="form-control" id="namaPengembali" placeholder="Nama yang Mengembalikan" required></div>
            <div class="col-md-4"><input class="form-control" id="lokasiKembali" placeholder="Lokasi Digunakan" required></div>
          </div>
          <button class="btn btn-primary mt-3">Simpan Pengembalian</button>
        </form>
      </div>
    </div>

    <!-- Cari Barang -->
    <div class="card mb-4">
      <div class="card-header bg-warning">🔍 Cari Barang</div>
      <div class="card-body">
        <div class="input-group">
          <input type="text" class="form-control" id="searchKey" placeholder="Nama/Kode Aset">
          <button class="btn btn-outline-secondary" onclick="cariBarang()">Cari</button>
        </div>
        <div id="hasilPencarian" class="mt-3"></div>
      </div>
    </div>

    <!-- Export & Import -->
    <div class="card mb-4">
      <div class="card-header bg-dark text-white">📁 Export & Import Database</div>
      <div class="card-body">
        <select class="form-select w-50 mb-2" onchange="handleDatabaseAction(this.value)">
          <option value="">-- Pilih Aksi --</option>
          <option value="export">📤 Export Data (.json)</option>
          <option value="import">📥 Import Data (.json)</option>
        </select>
        <input type="file" id="importFile" accept=".json" style="display:none" onchange="importData(event)">
      </div>
    </div>
  </div>

  <!-- Firebase & JS -->
  <script>
    // Konfigurasi Firebase - GANTI dengan milikmu
    const firebaseConfig = {
  apiKey: "AIzaSyBs3R8J9H6hQ96_Cm2WhWduPCK-uWJSzUo",
  authDomain: "loginsmartschool-4f57d.firebaseapp.com",
  databaseURL: "https://loginsmartschool-4f57d-default-rtdb.firebaseio.com",
  projectId: "loginsmartschool-4f57d",
  storageBucket: "loginsmartschool-4f57d.firebasestorage.app",
  messagingSenderId: "166215127727",
  appId: "1:166215127727:web:6888450f047c203871fa5a",
  measurementId: "G-8ZWH6QBTFV"
};
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // Simpan Peminjaman
    document.getElementById('formPinjam').addEventListener('submit', e => {
      e.preventDefault();
      const data = {
        nama: namaAsetPinjam.value,
        kode: kodeAsetPinjam.value,
        tanggal: tanggalPinjam.value,
        peminjam: namaPeminjam.value,
        lokasi: lokasiPinjam.value
      };
      db.ref('peminjaman/' + data.kode).set(data).then(() => {
        alert("✅ Data peminjaman disimpan.");
        e.target.reset();
      });
    });

    // Simpan Pengembalian
    document.getElementById('formKembali').addEventListener('submit', e => {
      e.preventDefault();
      const data = {
        nama: namaAsetKembali.value,
        kode: kodeAsetKembali.value,
        tanggal: tanggalKembali.value,
        pengembali: namaPengembali.value,
        lokasi: lokasiKembali.value
      };
      db.ref('pengembalian/' + data.kode).set(data).then(() => {
        alert("✅ Data pengembalian disimpan.");
        e.target.reset();
      });
    });

    // Cari Barang
    function cariBarang() {
      const key = searchKey.value.trim();
      if (!key) return;
      const out = document.getElementById('hasilPencarian');
      out.innerHTML = "<em>Mencari data...</em>";

      Promise.all([
        db.ref('peminjaman/' + key).get(),
        db.ref('pengembalian/' + key).get()
      ]).then(([pinjam, kembali]) => {
        let html = `<strong>Hasil untuk: ${key}</strong><br>`;
        if (pinjam.exists()) {
          const d = pinjam.val();
          html += `<div class="text-success"><b>Peminjaman:</b> ${d.nama}, ${d.tanggal}, ${d.peminjam}, ${d.lokasi}</div>`;
        } else {
          html += `<div class="text-muted">Tidak ada data peminjaman.</div>`;
        }
        if (kembali.exists()) {
          const d = kembali.val();
          html += `<div class="text-primary"><b>Pengembalian:</b> ${d.nama}, ${d.tanggal}, ${d.pengembali}, ${d.lokasi}</div>`;
        } else {
          html += `<div class="text-muted">Tidak ada data pengembalian.</div>`;
        }
        out.innerHTML = html;
      });
    }

    // Export & Import
    function handleDatabaseAction(val) {
      if (val === "export") exportData();
      if (val === "import") document.getElementById('importFile').click();
    }

    function exportData() {
      db.ref().get().then(snapshot => {
        const blob = new Blob([JSON.stringify(snapshot.val(), null, 2)], { type: 'application/json' });
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = "export-database.json";
        a.click();
      });
    }

    function importData(event) {
      const file = event.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = e => {
        const data = JSON.parse(e.target.result);
        db.ref().set(data).then(() => alert("✅ Database berhasil diimpor."));
      };
      reader.readAsText(file);
    }
  </script>

</body>
</html>
