<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Permintaan Konseling - Siswa</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
</head>
<body class="bg-light">
<div class="container py-4">
  <h2 class="text-center text-primary mb-4">ğŸ“ Permintaan Konseling Siswa</h2>

  <form id="formPermintaan" class="card p-4 shadow-sm mb-4">
    <div class="row mb-3">
      <div class="col-md-6">
        <label class="form-label">Nama Siswa</label>
        <input type="text" id="nama" class="form-control" required>
      </div>
      <div class="col-md-6">
        <label class="form-label">Kelas</label>
        <input type="text" id="kelas" class="form-control" required>
      </div>
    </div>
    <div class="mb-3">
      <label class="form-label">Topik Permintaan</label>
      <input type="text" id="topik" class="form-control" required>
    </div>
    <div class="row mb-3">
      <div class="col-md-6">
        <label class="form-label">Tanggal yang Diinginkan</label>
        <input type="date" id="tanggal" class="form-control" required>
      </div>
      <div class="col-md-6">
        <label class="form-label">Jam yang Diinginkan</label>
        <input type="time" id="jam" class="form-control" required>
      </div>
    </div>
    <button type="submit" class="btn btn-success">Kirim Permintaan</button>
  </form>

  <h4 class="text-secondary">ğŸ“‹ Daftar Permintaan Konseling</h4>
  <div class="table-responsive">
    <table class="table table-bordered text-center">
      <thead class="table-warning">
        <tr>
          <th>Nama</th>
          <th>Kelas</th>
          <th>Topik</th>
          <th>Tanggal</th>
          <th>Jam</th>
          <th>Status</th>
          <th>Aksi</th>
        </tr>
      </thead>
      <tbody id="tabelPermintaan">
        <!-- Data akan diisi dari Firebase -->
      </tbody>
    </table>
  </div>
</div>

<script>
  const firebaseConfig = {
  apiKey: "AIzaSyBs3R8J9H6hQ96_Cm2WhWduPCK-uWJSzUo",
  authDomain: "loginsmartschool-4f57d.firebaseapp.com",
  databaseURL: "https://loginsmartschool-4f57d-default-rtdb.firebaseio.com",
  projectId: "loginsmartschool-4f57d",
  storageBucket: "loginsmartschool-4f57d.firebasestorage.app",
  messagingSenderId: "166215127727",
  appId: "1:166215127727:web:6888450f047c203871fa5a",
  measurementId: "G-8ZWH6QBTFV"
};
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  const form = document.getElementById("formPermintaan");
  form.addEventListener("submit", function(e) {
    e.preventDefault();
    const data = {
      nama: document.getElementById("nama").value,
      kelas: document.getElementById("kelas").value,
      topik: document.getElementById("topik").value,
      tanggal: document.getElementById("tanggal").value,
      jam: document.getElementById("jam").value,
      status: "Menunggu"
    };
    db.ref("permintaan_konseling").push(data);
    form.reset();
    muatPermintaan();
  });

  function muatPermintaan() {
    const tabel = document.getElementById("tabelPermintaan");
    tabel.innerHTML = "";

    db.ref("permintaan_konseling").once("value", snapshot => {
      snapshot.forEach(child => {
        const data = child.val();
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${data.nama}</td>
          <td>${data.kelas}</td>
          <td>${data.topik}</td>
          <td>${data.tanggal}</td>
          <td>${data.jam}</td>
          <td><span class="badge bg-${data.status === 'Dijadwalkan' ? 'success' : 'secondary'}">${data.status}</span></td>
          <td>
            ${data.status === 'Menunggu' ? `
              <button class='btn btn-sm btn-success' onclick='konfirmasi("${child.key}")'>Konfirmasi</button>` : '-'}
            <button class='btn btn-sm btn-danger' onclick='hapusPermintaan("${child.key}")'>Hapus</button>
          </td>
        `;
        tabel.appendChild(tr);
      });
    });
  }

  function konfirmasi(id) {
    db.ref("permintaan_konseling/" + id).update({ status: "Dijadwalkan" });
    muatPermintaan();
  }

  function hapusPermintaan(id) {
    const kode = prompt("Masukkan kode akses untuk menghapus:");
    if (kode === "bksunggaljuara") {
      if (confirm("Yakin ingin menghapus permintaan ini?")) {
        db.ref("permintaan_konseling/" + id).remove();
        muatPermintaan();
      }
    } else {
      alert("Kode salah! Tidak diizinkan menghapus.");
    }
  }

  window.onload = muatPermintaan;
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
