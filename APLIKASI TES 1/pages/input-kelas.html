<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Input Kelas dan Siswa</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
  <div class="container mt-5">
    <h2>Input Kelas Baru</h2>

    <select id="kelasDropdown" class="form-select mb-3">
      <option value="">-- Pilih Kelas --</option>
    </select>

    <input type="text" id="namaSiswa" class="form-control mb-3" placeholder="Nama Lengkap Siswa">
    <button onclick="simpanKelas()" class="btn btn-primary mb-3">Simpan ke Firebase</button>

    <hr>
    <h4>üîê Aktifkan Fitur Import Excel</h4>
    <input type="password" id="kodeRahasia" class="form-control mb-2" placeholder="Masukkan Kode">
    <button onclick="cekKode()" class="btn btn-warning mb-3">Aktifkan Import</button>

    <div id="importSection" style="display:none;">
      <input type="file" id="fileExcel" accept=".xlsx" class="form-control mb-2">
      <button onclick="importExcel()" class="btn btn-success mb-3">Import Siswa</button>
      <p><a href="Template_Siswa.xlsx" download>üì• Unduh Template Excel</a></p>
    </div>
  </div>

  <!-- Firebase & SheetJS -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

  <script>
    // GANTI CONFIG INI DENGAN PUNYAMU
    const firebaseConfig = {
      apiKey: "ISI_API_KEY_KAMU",
      authDomain: "ISI_AUTH_DOMAIN",
      databaseURL: "ISI_DATABASE_URL",
      projectId: "ISI_PROJECT_ID",
      storageBucket: "ISI_STORAGE_BUCKET",
      messagingSenderId: "ISI_SENDER_ID",
      appId: "ISI_APP_ID"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // Buat dropdown kelas
    const dropdown = document.getElementById("kelasDropdown");
    const kelasList = [];
    for (let i = 1; i <= 13; i++) kelasList.push("X." + i);
    for (let i = 1; i <= 12; i++) kelasList.push("XI." + i);
    for (let i = 1; i <= 11; i++) kelasList.push("XII." + i);
    kelasList.forEach(kls => {
      const opt = document.createElement("option");
      opt.value = kls;
      opt.textContent = kls;
      dropdown.appendChild(opt);
    });

    function simpanKelas() {
      const nama = document.getElementById("namaSiswa").value;
      const kelas = dropdown.value;
      if (!nama || !kelas) return alert("Isi nama dan pilih kelas!");
      db.ref("siswa").push({ nama, kelas, waktu: new Date().toISOString() });
      alert("‚úÖ Data siswa disimpan!");
      document.getElementById("namaSiswa").value = "";
    }

    function cekKode() {
      const kode = document.getElementById("kodeRahasia").value;
      if (kode === "5UGJV99QQT") {
        document.getElementById("importSection").style.display = "block";
        alert("‚úÖ Fitur Import Diaktifkan");
      } else {
        alert("‚ùå Kode salah!");
      }
    }

    function importExcel() {
      const file = document.getElementById("fileExcel").files[0];
      if (!file) return alert("Pilih file Excel terlebih dahulu!");

      const reader = new FileReader();
      reader.onload = function(e) {
        const data = new Uint8Array(e.target.result);
        const workbook = XLSX.read(data, {type: 'array'});
        const sheet = workbook.Sheets[workbook.SheetNames[0]];
        const json = XLSX.utils.sheet_to_json(sheet);

        json.forEach(row => {
          if (row["Nama"] && row["Kelas"]) {
            db.ref("siswa").push({
              nama: row["Nama"],
              kelas: row["Kelas"],
              waktu: new Date().toISOString()
            });
          }
        });

        alert("‚úÖ Import selesai!");
      };
      reader.readAsArrayBuffer(file);
    }
  </script>
</body>
</html>
