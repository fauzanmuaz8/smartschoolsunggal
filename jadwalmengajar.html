<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Dashboard Jadwal Mengajar - SMAN 1 Sunggal</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>
  <style>
    body { background: linear-gradient(135deg, #dbeafe, #f0f9ff); min-height: 100vh; }
    .tab-pane { margin-top: 20px; }
  </style>
</head>
<body>
<div class="container py-4">
  <h3 class="text-center">📘 Dashboard Jadwal Mengajar - SMAN 1 Sunggal</h3>

  <ul class="nav nav-tabs mt-4" id="tabMenu" role="tablist">
    <li class="nav-item" role="presentation">
      <button class="nav-link active" id="input-tab" data-bs-toggle="tab" data-bs-target="#input" type="button" role="tab">Input Jadwal Mengajar</button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="lihat-tab" data-bs-toggle="tab" data-bs-target="#lihat" type="button" role="tab">Lihat Jadwal Mengajar</button>
    </li>
  </ul>

  <div class="tab-content" id="tabContent">
    <!-- Input Jadwal -->
    <div class="tab-pane fade show active" id="input" role="tabpanel">
      <form id="formJadwal" class="bg-white p-3 shadow rounded mt-3">
        <div class="mb-2">
          <label class="form-label">Kode Akses</label>
          <input type="password" id="kodeAkses" class="form-control" required placeholder="Masukkan kode akses">
        </div>
        <div class="row g-2">
          <div class="col-md-3">
            <label class="form-label">Hari</label>
            <select id="hari" class="form-select" required>
              <option value="">Pilih Hari</option>
              <option>Senin</option><option>Selasa</option><option>Rabu</option>
              <option>Kamis</option><option>Jumat</option><option>Sabtu</option>
            </select>
          </div>
          <div class="col-md-2">
            <label class="form-label">Jam Ke-</label>
            <select id="jamke" class="form-select" required>
              <option value="">Pilih Jam</option>
              <option>1</option><option>2</option><option>3</option><option>4</option>
              <option>5</option><option>6</option><option>7</option><option>8</option>
              <option>9</option><option>10</option><option>11</option><option>12</option>
            </select>
          </div>
          <div class="col-md-3">
            <label class="form-label">Jam Pelajaran</label>
            <input type="text" id="jamPelajaran" class="form-control" placeholder="Contoh: 07.30 - 08.15">
          </div>
          <div class="col-md-2">
            <label class="form-label">Inisial Guru</label>
            <input type="text" id="guru" class="form-control" placeholder="Contoh: AB">
          </div>
          <div class="col-md-2">
            <label class="form-label">Kelas</label>
            <input type="text" id="kelas" class="form-control" placeholder="Contoh: X 1">
          </div>
        </div>
        <div class="mt-3 text-end">
          <button type="submit" class="btn btn-primary">Simpan Jadwal</button>
        </div>
      </form>
    </div>

    <!-- Lihat Jadwal -->
    <div class="tab-pane fade" id="lihat" role="tabpanel">
      <div class="row g-2 mt-3">
        <div class="col-md-4">
          <label class="form-label">Pilih Hari</label>
          <select id="filterHari" class="form-select">
            <option value="">Semua Hari</option>
            <option>Senin</option><option>Selasa</option><option>Rabu</option>
            <option>Kamis</option><option>Jumat</option><option>Sabtu</option>
          </select>
        </div>
        <div class="col-md-4">
          <label class="form-label">Pilih Inisial Guru</label>
          <select id="filterGuru" class="form-select">
            <option value="">Semua Guru</option>
          </select>
        </div>
        <div class="col-md-4 text-end">
          <label class="form-label">&nbsp;</label><br>
          <button onclick="exportExcel()" class="btn btn-success me-2">Export Excel</button>
          <button onclick="exportPDF()" class="btn btn-danger">Export PDF</button>
        </div>
      </div>
      <div class="table-responsive bg-white shadow rounded mt-3 p-3">
        <table class="table table-bordered" id="tabelJadwal">
          <thead class="table-dark">
            <tr>
              <th>Hari</th><th>Jam Ke</th><th>Jam</th><th>Guru</th><th>Kelas</th>
            </tr>
          </thead>
          <tbody id="dataJadwal"></tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyBs3R8J9H6hQ96_Cm2WhWduPCK-uWJSzUo",
    authDomain: "loginsmartschool-4f57d.firebaseapp.com",
    databaseURL: "https://loginsmartschool-4f57d-default-rtdb.firebaseio.com",
    projectId: "loginsmartschool-4f57d",
    storageBucket: "loginsmartschool-4f57d.firebasestorage.app",
    messagingSenderId: "166215127727",
    appId: "1:166215127727:web:6888450f047c203871fa5a",
    measurementId: "G-8ZWH6QBTFV"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  document.getElementById("formJadwal").addEventListener("submit", e => {
    e.preventDefault();
    if (kodeAkses.value !== "sunggaljuara123") {
      alert("❌ Kode akses salah!");
      return;
    }
    const data = {
      hari: hari.value,
      jamke: jamke.value,
      jam: jamPelajaran.value,
      guru: guru.value,
      kelas: kelas.value
    };
    db.ref("jadwal").push(data);
    alert("✅ Jadwal berhasil disimpan!");
    formJadwal.reset();
    loadJadwal();
  });

  function loadJadwal() {
    db.ref("jadwal").on("value", snapshot => {
      const data = snapshot.val();
      const tbody = document.getElementById("dataJadwal");
      const guruSet = new Set();
      tbody.innerHTML = "";
      for (let id in data) {
        const d = data[id];
        if ((filterHari.value && d.hari !== filterHari.value) || (filterGuru.value && d.guru !== filterGuru.value)) continue;
        guruSet.add(d.guru);
        tbody.innerHTML += `
          <tr>
            <td>${d.hari}</td>
            <td>${d.jamke}</td>
            <td>${d.jam}</td>
            <td>${d.guru}</td>
            <td>${d.kelas}</td>
          </tr>`;
      }
      const guruDropdown = document.getElementById("filterGuru");
      guruDropdown.innerHTML = '<option value="">Semua Guru</option>';
      guruSet.forEach(g => {
        guruDropdown.innerHTML += `<option value="${g}">${g}</option>`;
      });
    });
  }

  function exportExcel() {
    const wb = XLSX.utils.book_new();
    const ws = XLSX.utils.table_to_sheet(document.getElementById("tabelJadwal"));
    XLSX.utils.book_append_sheet(wb, ws, "Jadwal");
    XLSX.writeFile(wb, "jadwal-mengajar.xlsx");
  }

  async function exportPDF() {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    doc.text("Laporan Jadwal Mengajar", 10, 10);
    const rows = [];
    document.querySelectorAll("#dataJadwal tr").forEach(tr => {
      const cols = [...tr.children].map(td => td.innerText);
      rows.push(cols);
    });
    doc.autoTable({ head: [["Hari","Jam Ke","Jam","Guru","Kelas"]], body: rows });
    doc.save("jadwal-mengajar.pdf");
  }

  document.getElementById("filterHari").addEventListener("change", loadJadwal);
  document.getElementById("filterGuru").addEventListener("change", loadJadwal);
  window.onload = loadJadwal;
</script>
</body>
</html>
